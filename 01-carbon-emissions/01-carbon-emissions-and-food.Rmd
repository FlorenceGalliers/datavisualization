---
title: "01-carbon-emissions-and-food"
author: "Florence Galliers"
date: "17/01/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(extrafont)
#font_import()
library(plyr)
```

## Introduction

This dataset contains information about 130 countries, their consumption and emissions of 11 types of food.


```{r }
food_consumption <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-18/food_consumption.csv')

# How many countries?
unique(food_consumption$country)
# 130

# How many food categories?
unique(food_consumption$food_category)
# 11

food_consumption$difference <- food_consumption$co2_emmission - food_consumption$consumption

# Biggest differences between consumption and emissions, both positive and negative?
tail(sort(food_consumption$difference), 5)
head(sort(food_consumption$difference), 5)

top10 <- food_consumption %>%
  filter(food_consumption$difference >= 989 | food_consumption$difference <= -132)

top10$food_category <- as.factor(top10$food_category)

ggplot(data = top10,
       aes(x = reorder(country, -difference), y = difference), 
       fill = food_category) +
  geom_bar(stat = "identity")

```

Consumption per food category worldwide?
So which food category is most popular 

```{r}

# make category a factor
food_consumption$food_category <- factor(food_consumption$food_category)

levels(food_consumption$food_category)
# rename some of the levels
food_consumption$food_category <- revalue(food_consumption$food_category,
        c("Lamb & Goat" = "Lamb/Goat",
          "Milk - inc. cheese" = "Dairy",
          "Nuts inc. Peanut Butter" = "Nuts",
          "Wheat and Wheat Products" = "Wheat Products"))

boxplot(consumption ~ reorder(food_category, consumption),
        data = food_consumption,
        xlab = "")



ggplot(data = food_consumption,
       aes(x = reorder(food_category, consumption),
       y = consumption)) +
  labs(title = "World Food Categories",
       subtitle = "Distribution of food consumption throughout the world",
       caption = "Source = nu3 Food Carbon Footprint Index 2018") +
  geom_boxplot() +
  theme_classic() +
  theme(axis.text.x = element_text(),
        axis.title.x = element_text()) 


```

Battle of the animals
- Which meat is consumed most widely across the world, and which contributes the most CO2 emissions?

```{r}
# filter the dataset to only contain meat categories:

meat <- food_consumption %>%
  filter(food_category == "Pork" | food_category == "Poultry" | food_category == "Beef" | food_category == "Lamb/Goat" | food_category == "Fish")

meat$food_category <- as.factor(meat$food_category)

ggplot(meat, 
       aes(x = reorder(food_category, consumption), 
           y = consumption)) +
  geom_bar(stat = "identity") +
  coord_flip()
  
# what about combining consumption and emissions onto one plot?
# first need to tidy data

meat_tidy <- meat %>%
  pivot_longer(names(meat)[3:4],
               names_to = "type",
               values_to = "kg")

ggplot(meat_tidy, 
       aes(fill = type, x = food_category, y = kg)) +
  geom_bar(stat = "identity",
           position = "dodge") +
  coord_flip()

# looks fine but maybe using the 'difference' category would be better.

ggplot(meat, 
       aes(x = reorder(food_category, difference), 
           y = difference)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "BATTLE OF THE ANIMALS",
       subtitle = "The difference between consumption of meat (kg/person/year) 
and their carbon emissions (kg CO2/person/year) worldwide")

# subset for each type of meat and find the highest value
beef <- meat %>%
  filter(food_category == "Beef")
beef[which.max(beef$co2_emmission), ]
argentina_value <- as.numeric(beef[which.max(beef$co2_emmission), 4])

lamb <- meat %>%
  filter(food_category == "Lamb/Goat")
lamb[which.max(lamb$co2_emmission), ]
iceland_value <- as.numeric(lamb[which.max(lamb$co2_emmission), 4])

fish <- meat %>%
  filter(food_category == "Fish")
fish[which.max(fish$co2_emmission), ]
maldives_value <- as.numeric(fish[which.max(fish$co2_emmission), 4])

pork <- meat %>%
  filter(food_category == "Pork")
pork[which.max(pork$co2_emmission), ]
hongkong_value <- as.numeric(pork[which.max(pork$co2_emmission), 4])

# remove these values from the meat_edit dataset
meat_edit <- meat[-(which(meat$co2_emmission == argentina_value | 
        meat$co2_emmission == iceland_value |
        meat$co2_emmission == maldives_value |
        meat$co2_emmission == hongkong_value)), ]

# subset each value into its own data frame so it can be plotted separately.
argentina <- meat %>%
  filter(country == "Argentina" & food_category == "Beef")
# Iceland - Lamb/Goat
iceland <- meat %>%
  filter(country == "Iceland" & food_category == "Lamb/Goat")
# Maldives - Fish
maldives <- meat %>%
  filter(country == "Maldives" & food_category == "Fish")
# Hong Kong - Pork
hongkong <- meat %>%
  filter(country == "Hong Kong SAR. China" & food_category == "Pork")

# Plot a strip chart
plot1 <- ggplot(meat_edit, 
       aes(x = reorder(food_category, co2_emmission), 
           y = co2_emmission, 
           size = consumption)) +
  geom_point(position = position_jitter(seed = 41),
             colour = "grey70") +
  coord_flip() +
  labs(title = "Which countries are responsible for the highest CO2 emissions?") +
  ylab("CO2 emissions (kg CO2/person/year)") +
  scale_x_discrete(labels = c("POULTRY", "FISH", "PORK", "LAMB/GOAT", "BEEF")) +
  theme(plot.title = element_text(family = "Avenir", 
                                  size = 16, 
                                  colour = "#840a35"),
        axis.title.y = element_blank(),
        axis.title.x = element_text(family = "Avenir",
                                    size = 8),
        plot.background = element_rect(fill = "#f1f1f1"),
        panel.background = element_rect(fill = "#f1f1f1"),
        panel.grid = element_blank(),
        axis.ticks = element_blank(),
        axis.text.y = element_text(angle = 90, hjust=0.5, vjust = -8,
                                   face = "bold", size = 9, 
                                   family = "Avenir"),
        axis.text.x = element_text(family = "Avenir"),
        legend.position = "bottom",
        legend.text = element_text()) +
  geom_point(data = argentina, position = position_jitter(seed = 41), 
             colour = "#840a35") +
  geom_point(data = iceland, position = position_jitter(seed = 41), 
             colour = "purple") +
  geom_point(data = hongkong, position = position_jitter(seed = 41), 
             colour = "orange") +
  geom_point(data = maldives, position = position_jitter(seed = 41), 
             colour = "royalblue") + 
  # argentina arrow
  annotate("curve",
    xend = 4.65, yend = 1700,
    x = 4.2, y = 1600,
    curvature = .2,
    arrow = arrow(type = "closed", length = unit(0.40, "lines")),
    colour = "#840a35") +
  # argentina text
  annotate("text", x = 4.2, y = 1515,
           label = "ARGENTINA",
           colour = "#840a35",
           size = 4,
           family = "Avenir") +
  # iceland arrow
    annotate("curve",
    xend = 3.7, yend = 780,
    x = 3.2, y = 950,
    curvature = -.2,
    arrow = arrow(type = "closed", length = unit(0.40, "lines")),
    colour = "purple") +
  # iceland text
  annotate("text", x = 3.2, y = 1000,
           label = "ICELAND",
           colour = "purple",
           size = 4,
           family = "Avenir") +
  # hong kong arrow
    annotate("curve",
    xend = 2.8, yend = 300,
    x = 2.8, y = 450,
    curvature = .2,
    arrow = arrow(type = "closed", length = unit(0.40, "lines")),
    colour = "orange") +
  # hong kong text
  annotate("text", x = 2.8, y = 500,
           label = "HONG KONG",
           colour = "orange",
           size = 4,
           family = "Avenir") +  
  # maldives arrow
    annotate("curve",
    xend = 1.65, yend = 350,
    x = 1.2, y = 450,
    curvature = .2,
    arrow = arrow(type = "closed", length = unit(0.40, "lines")),
    colour = "royalblue") +
  # maldives text
  annotate("text", x = 1.2, y = 450,
           label = "MALDIVES",
           colour = "royalblue",
           size = 4,
           family = "Avenir")

plot1
 


```

